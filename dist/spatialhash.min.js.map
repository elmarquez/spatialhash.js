{"version":3,"sources":["spatialhash.js"],"names":["window","SpatialHash","getAABBCells","aabb","cellSize","i","j","k","max","min","points","x","Math","ceil","y","z","floor","push","getDistanceToPoint","plane","p","getDotProduct","normal","constant","v1","v2","getPositionEnvelope","pos","conversionFactor","getUnboundedPositionHashKey","intersectsBox","planes","box","d1","d2","p1","p2","mergeArray","left","right","Array","isArray","concat","mergeFields","Object","keys","forEach","key","hasOwnProperty","item","Index","config","self","this","INDEXING_STRATEGY","BOUNDED","UNBOUNDED","MAX_WORKERS","cells","envelopes","indexingStrategy","objects","positions","scripts","EVAL","THREE","getPositionHash","width","prototype","clear","getBoundedHashKey","Error","getUnboundedHashKey","getCellsIntersectingAABB","intersects","cell","getCellsIntersectingFrustum","frustum","opt","pa","Promise","resolve","reject","env","evalPath","Parallel","require","fn","name","map","global","reduce","result","then","data","err","getEntitiesIntersectingFrustum","length","objs","getEntitiesIntersectingScreenRectangle","rec","Vector3","Box3","setFromPoints","entities","getAABBCellKeys","getVerticesIntersectingFrustum","id","insert","index","metadata","position","vertex","insertAll","opts","count","faces","edges","vertices","list","obj","record","records","envelope","intersectsViewSelection","near","radius","limit","Infinity","setFromCenterAndSize","nearest","remove","indexOf","splice"],"mappings":"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","file":"spatialhash.min.js"}