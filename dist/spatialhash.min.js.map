{"version":3,"sources":["spatialhash.js"],"names":["window","SpatialHash","getAABBCells","aabb","cellSize","i","j","k","max","min","points","x","Math","ceil","y","z","floor","push","getDistanceToPoint","plane","p","getDotProduct","normal","constant","v1","v2","getPositionEnvelope","pos","conversionFactor","getUnboundedPositionHashKey","intersectsBox","planes","box","d1","d2","p1","p2","mergeArray","left","right","merged","concat","undefined","Array","isArray","mergeFields","Object","keys","forEach","key","hasOwnProperty","item","Index","config","self","this","INDEXING_STRATEGY","BOUNDED","UNBOUNDED","MAX_WORKERS","cells","envelopes","indexingStrategy","objects","scripts","EVAL","THREE","getPositionHash","width","prototype","clear","getBoundedHashKey","Error","getUnboundedHashKey","getCellsIntersectingAABB","intersects","cell","getCellsIntersectingFrustum","frustum","opt","pa","Promise","resolve","reject","env","evalPath","Parallel","require","fn","name","map","global","reduce","result","then","data","err","getEntitiesIntersectingFrustum","length","objs","getEntitiesIntersectingScreenRectangle","rec","Vector3","Box3","setFromPoints","entities","getAABBCellKeys","getVerticesIntersectingFrustum","id","insert","index","metadata","position","vertex","insertAll","opts","count","faces","edges","vertices","list","obj","record","records","envelope","intersectsViewSelection","near","radius","limit","Infinity","setFromCenterAndSize","nearest","remove","indexOf","splice"],"mappings":"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","file":"spatialhash.min.js"}