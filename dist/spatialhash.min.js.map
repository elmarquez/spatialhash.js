{"version":3,"sources":["spatialhash.js"],"names":["window","SpatialHash","getAABBCells","aabb","cellSize","i","j","k","max","min","points","x","Math","ceil","y","z","floor","push","getDistanceToPoint","plane","p","getDotProduct","normal","constant","v1","v2","getPositionEnvelope","pos","conversionFactor","getUnboundedPositionHashKey","intersectsBox","planes","box","d1","d2","p1","p2","mergeArray","left","right","merged","concat","undefined","Array","isArray","mergeFields","Object","keys","forEach","key","hasOwnProperty","item","Index","config","self","this","INDEXING_STRATEGY","BOUNDED","UNBOUNDED","MAX_WORKERS","cells","envelopes","indexingStrategy","objects","scripts","EVAL","THREE","getPositionHash","width","prototype","clear","getBoundedHashKey","Error","getUnboundedHashKey","getCellsIntersectingAABB","intersects","cell","getCellsIntersectingFrustum","frustum","opt","pa","start","Date","getTime","Promise","resolve","reject","env","evalPath","Parallel","require","fn","name","map","global","reduce","result","then","data","err","console","info","getEntitiesIntersectingFrustum","length","objs","getEntitiesIntersectingScreenRectangle","rec","Vector3","Box3","setFromPoints","entities","getAABBCellKeys","getVerticesIntersectingFrustum","id","insert","index","metadata","position","vertex","insertAll","opts","count","faces","edges","vertices","list","obj","record","records","envelope","intersectsViewSelection","near","radius","limit","Infinity","setFromCenterAndSize","nearest","remove","indexOf","splice"],"mappings":"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","file":"spatialhash.min.js"}